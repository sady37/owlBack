# ç°æœ‰å®ç°è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

å·²æœ‰å…¶ä»–åŒäº‹å®ç°äº† **radar-server ä¹‹é—´çš„ MQTT é€šä¿¡**ï¼ŒåŒ…æ‹¬ï¼š

1. MQTT å®¢æˆ·ç«¯å°è£…
2. wisefido-radar æœåŠ¡ï¼ˆMQTT è®¢é˜…å’Œæ•°æ®å¤„ç†ï¼‰
3. wisefido-sleepace æœåŠ¡ï¼ˆMQTT è®¢é˜…å’Œæ•°æ®å¤„ç†ï¼‰

## ğŸ” éœ€è¦äº†è§£çš„ä¿¡æ¯

### 1. Redis Streams æ•°æ®æ ¼å¼

**é—®é¢˜**: ç°æœ‰å®ç°å‘å¸ƒåˆ° Redis Streams çš„æ•°æ®æ ¼å¼æ˜¯ä»€ä¹ˆï¼Ÿ

**å¯èƒ½çš„æ ¼å¼**:
```json
{
    "device_id": "uuid",
    "tenant_id": "uuid",
    "serial_number": "xxx",
    "uid": "xxx",
    "device_type": "Radar",
    "raw_data": {
        // åŸå§‹ MQTT æ¶ˆæ¯æ•°æ®
    },
    "timestamp": 1234567890,
    "topic": "radar/xxx/data"
}
```

**éœ€è¦ç¡®è®¤**:
- Stream åç§°ï¼ˆå¦‚ `radar:data:stream`, `sleepace:data:stream`ï¼‰
- æ•°æ®å­—æ®µç»“æ„
- æ—¶é—´æˆ³æ ¼å¼

### 2. æ•°æ®æ ‡å‡†åŒ–éœ€æ±‚

**é—®é¢˜**: åŸå§‹æ•°æ®éœ€è¦å¦‚ä½•æ ‡å‡†åŒ–ï¼Ÿ

**å¯èƒ½çš„å¤„ç†**:
- SNOMED CT ç¼–ç æ˜ å°„
- FHIR Category åˆ†ç±»
- æ•°æ®éªŒè¯å’Œæ¸…æ´—
- å•ä½è½¬æ¢

### 3. è®¾å¤‡æ ‡è¯†ç¬¦

**é—®é¢˜**: å¦‚ä½•ä» MQTT ä¸»é¢˜æˆ–æ•°æ®ä¸­è¯†åˆ«è®¾å¤‡ï¼Ÿ

**å¯èƒ½çš„æ–¹æ¡ˆ**:
- ä»ä¸»é¢˜æå–ï¼š`radar/{device_id}/data`
- ä»æ•°æ®ä¸­æå–ï¼š`serial_number` æˆ– `uid`
- æŸ¥è¯¢ `devices` è¡¨éªŒè¯

## ğŸ“ å»ºè®®

1. **ä¸åŒäº‹æ²Ÿé€š**ï¼Œäº†è§£ç°æœ‰å®ç°ç»†èŠ‚
2. **æŸ¥çœ‹ä»£ç **ï¼Œç¡®è®¤æ•°æ®æ ¼å¼å’Œæ¥å£
3. **æµ‹è¯•æ•°æ®æµ**ï¼ŒéªŒè¯ Redis Streams ä¸­çš„æ•°æ®æ ¼å¼

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `wisefido-radar/internal/consumer/mqtt_consumer.go` - MQTT æ¶ˆè´¹è€…å®ç°
- `owl-common/mqtt/client.go` - MQTT å®¢æˆ·ç«¯å°è£…ï¼ˆå¦‚æœå·²å®ç°ï¼‰
- Redis Streams ç›¸å…³ä»£ç 

