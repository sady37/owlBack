# 代码审查前检查清单

> **目的**: 在提交给 ChatGPT 或其他 AI 审查前，确保代码和文档符合规范

---

## ✅ 代码检查清单

### 1. 代码质量 ✅

- [ ] **命名规范**
  - [ ] 函数名清晰表达功能
  - [ ] 变量名有意义
  - [ ] 常量使用全大写

- [ ] **代码结构**
  - [ ] 文件组织合理
  - [ ] 导入顺序正确
  - [ ] 函数长度合理（< 50 行）

- [ ] **错误处理**
  - [ ] 所有错误都被处理
  - [ ] 错误信息有意义
  - [ ] 使用 `%w` 包装错误

- [ ] **注释**
  - [ ] 包级别有注释
  - [ ] 公开函数有注释
  - [ ] 复杂逻辑有注释

### 2. 性能 ⚠️

- [ ] **数据库查询**
  - [ ] 无 N+1 查询
  - [ ] 使用批量查询
  - [ ] 查询有索引

- [ ] **内存使用**
  - [ ] 预分配切片容量
  - [ ] 避免不必要的内存分配

### 3. 安全性 ✅

- [ ] **SQL 注入防护**
  - [ ] 使用参数化查询
  - [ ] 无字符串拼接 SQL

- [ ] **输入验证**
  - [ ] UUID 格式验证
  - [ ] 数值范围验证

### 4. 并发安全 ⚠️

- [ ] **共享资源保护**
  - [ ] 使用锁保护共享资源
  - [ ] 使用原子操作

---

## ✅ 文档检查清单

### 1. 文档结构 ✅

- [ ] **必需章节**
  - [ ] 概述/背景
  - [ ] 目标/目的
  - [ ] 详细内容
  - [ ] 总结/下一步

- [ ] **元信息**
  - [ ] 日期
  - [ ] 版本
  - [ ] 作者

### 2. 内容质量 ✅

- [ ] **清晰性**
  - [ ] 语言清晰
  - [ ] 无歧义
  - [ ] 有具体示例

- [ ] **完整性**
  - [ ] 覆盖所有关键点
  - [ ] 提供足够上下文
  - [ ] 解释设计决策

### 3. 代码示例 ✅

- [ ] **格式**
  - [ ] 有语言标识
  - [ ] 有详细注释
  - [ ] 可运行

- [ ] **准确性**
  - [ ] 代码示例准确
  - [ ] 与实际代码一致

---

## 🎯 提交给 ChatGPT 审查前的准备

### 步骤 1: 代码清理

```bash
# 1. 格式化代码
go fmt ./...

# 2. 检查代码规范
go vet ./...

# 3. 检查未使用的导入
goimports -w .

# 4. 编译验证
go build ./...
```

### 步骤 2: 文档完善

- [ ] 添加缺失的注释
- [ ] 完善函数文档
- [ ] 添加设计决策说明
- [ ] 统一术语

### 步骤 3: 准备审查材料

#### 3.1 选择关键文件
- `wisefido-sensor-fusion/internal/fusion/sensor_fusion.go`
- `wisefido-sensor-fusion/internal/repository/card.go`
- `wisefido-data-transformer/internal/transformer/sleepace.go`

#### 3.2 准备提示词
```
请审查以下 Go 代码，重点关注：

1. **代码质量**
   - 命名是否清晰？
   - 函数是否过长？
   - 是否有重复代码？

2. **潜在错误**
   - 是否有逻辑错误？
   - 是否有边界条件未处理？
   - 是否有空指针风险？

3. **性能问题**
   - 是否有 N+1 查询？
   - 是否有不必要的循环？
   - 是否有内存泄漏风险？

4. **并发安全**
   - 是否有数据竞争？
   - 是否需要加锁？

5. **最佳实践**
   - 是否符合 Go 代码规范？
   - 错误处理是否完善？

[粘贴代码]
```

---

## 📊 当前状态

### 代码规范
- **评分**: 6.0/10
- **主要问题**: 
  - ⚠️ 缺少详细注释
  - ⚠️ N+1 查询问题
  - ⚠️ 缺少单元测试

### 文档规范
- **评分**: 7.2/10
- **主要问题**:
  - ⚠️ 代码示例注释不够详细
  - ⚠️ 设计决策说明不够充分

---

## 🚀 改进计划

### 立即执行
1. [ ] 添加详细函数注释
2. [ ] 修复 N+1 查询问题
3. [ ] 完善设计文档

### 短期改进
4. [ ] 添加单元测试
5. [ ] 添加并发保护
6. [ ] 统一术语表

---

## 📝 提交检查清单

### 代码
- [ ] `go fmt` 通过
- [ ] `go vet` 通过
- [ ] 编译成功
- [ ] 有详细注释
- [ ] 错误处理完善

### 文档
- [ ] 结构完整
- [ ] 内容清晰
- [ ] 代码示例准确
- [ ] 术语统一

---

**最后更新**: 2024-12-19

