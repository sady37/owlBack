# ChatGPT 第1轮审查提示词

> **用途**: 提交给 ChatGPT 进行代码审查的标准提示词

---

## 📋 提示词内容

请将以下内容复制并提交给 ChatGPT：

---

```
请审查以下 Go 代码，重点关注以下方面：

## 审查文件

### 1. sensor_fusion.go (核心融合逻辑)

这是传感器融合服务的核心文件，负责将多个设备（Sleepace + Radar）的数据融合为统一的实时数据格式。

### 2. card.go (数据访问层)

这是数据访问层，负责查询卡片和设备关联关系。

### 3. sleepace.go (数据转换)

这是数据转换器，负责将 Sleepace 原始数据转换为标准化格式。

---

## 审查重点

### 1. 代码质量
- 命名是否清晰、符合 Go 规范？
- 函数是否过长（建议 < 50 行）？
- 是否有重复代码？
- 代码结构是否清晰？

### 2. 潜在错误
- 是否有逻辑错误？
- 是否有边界条件未处理？
- 是否有空指针风险？
- 是否有数组越界风险？

### 3. 性能问题
- 是否有 N+1 查询问题？
- 是否有不必要的循环？
- 是否有内存泄漏风险？
- 是否有不必要的内存分配？

### 4. 并发安全
- 是否有数据竞争？
- 是否需要加锁？
- Context 使用是否正确？

### 5. 错误处理
- 所有错误是否都被处理？
- 错误信息是否有意义？
- 是否使用了 %w 包装错误？

### 6. 最佳实践
- 是否符合 Go 代码规范？
- 是否使用了合适的 Go 特性？
- 是否有更好的实现方式？

### 7. 安全性
- 是否有 SQL 注入风险？
- 是否有输入验证？
- 敏感信息是否泄露？

---

## 代码文件

### 文件 1: sensor_fusion.go

```go
[粘贴完整的 sensor_fusion.go 代码]
```

### 文件 2: card.go (相关部分)

```go
[粘贴 card.go 的相关代码]
```

### 文件 3: sleepace.go (相关部分)

```go
[粘贴 sleepace.go 的相关代码]
```

---

## 设计背景

### 传感器融合规则
1. **HR/RR（心率/呼吸率）**: 优先使用 Sleepace 数据，如果 Sleepace 无数据则使用 Radar 数据
2. **床状态/睡眠状态**: 优先使用 Sleepace 数据，如果 Sleepace 无数据则使用 Radar 数据（如果有）
3. **姿态数据**: 合并所有 Radar 设备的 tracking_id（不跨设备去重）

### 已知问题
- 当前实现存在 N+1 查询问题（在 `FuseCardData` 方法中，对每个设备单独查询）
- 姿态数据融合中，时间戳比较逻辑未实现（TODO 注释）

---

## 请提供

1. **发现的问题列表**（按严重性排序）
   - 问题描述
   - 位置（文件:行号）
   - 严重性（高/中/低）
   - 修复建议

2. **代码质量评分**（1-10 分）
   - 总体评分
   - 分项评分（代码质量、性能、安全性、可维护性、最佳实践）

3. **改进建议**
   - 高优先级建议
   - 中优先级建议

4. **总体评价**
   - 优点
   - 需要改进的地方

---

请详细审查并提供反馈。
```

---

## 📝 使用说明

1. **复制提示词**: 复制上面的完整提示词
2. **替换代码**: 将 `[粘贴...代码]` 部分替换为实际代码
3. **提交给 ChatGPT**: 将完整的提示词提交给 ChatGPT
4. **记录反馈**: 将 ChatGPT 的反馈记录到 `chatgpt_round1_sensor_fusion.md`

---

## ✅ 检查清单

提交前检查：
- [ ] 代码已格式化
- [ ] 代码已编译通过
- [ ] 所有代码片段已替换
- [ ] 提示词完整

---

**准备日期**: 2024-12-19

