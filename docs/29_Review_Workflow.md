# 代码审查工作流程

> **目的**: 建立 ChatGPT 和 Claude 之间的迭代审查流程

---

## 🔄 完整工作流程

```
┌─────────────────┐
│  准备审查材料   │
│  (代码+文档)    │
└────────┬────────┘
         ↓
┌─────────────────┐
│ ChatGPT 第1轮    │
│   审查代码      │
└────────┬────────┘
         ↓
┌─────────────────┐
│  记录反馈       │
│ (使用模板)      │
└────────┬────────┘
         ↓
┌─────────────────┐
│ 提交给 Claude   │
│  (反馈+代码)    │
└────────┬────────┘
         ↓
┌─────────────────┐
│ Claude 分析     │
│ 并作出回应      │
└────────┬────────┘
         ↓
┌─────────────────┐
│  修复代码       │
│  (根据反馈)     │
└────────┬────────┘
         ↓
┌─────────────────┐
│ ChatGPT 第2轮   │
│   审查代码      │
│ (改进后+回应)   │
└────────┬────────┘
         ↓
┌─────────────────┐
│  评估结果       │
│  (是否满意?)    │
└────────┬────────┘
         ↓
    ┌────┴────┐
    │ 是/否   │
    └────┬────┘
         │
    ┌────┴────┐
    │   否    │
    │ 继续迭代│
    └─────────┘
```

---

## 📋 详细步骤

### 步骤 1: 准备审查材料

#### 1.1 选择审查文件

**关键文件**:
- `wisefido-sensor-fusion/internal/fusion/sensor_fusion.go`
- `wisefido-sensor-fusion/internal/repository/card.go`
- `wisefido-data-transformer/internal/transformer/sleepace.go`

#### 1.2 准备代码

```bash
# 1. 确保代码格式正确
go fmt ./...

# 2. 确保编译通过
go build ./...

# 3. 检查注释完整性
# 确保所有公开函数有注释
```

#### 1.3 准备文档

- [ ] 代码规范文档
- [ ] 设计文档
- [ ] 审查前检查清单

---

### 步骤 2: ChatGPT 第1轮审查

#### 2.1 使用提示词

参考 `docs/24_ChatGPT_Review_Prompt.md`

#### 2.2 记录反馈

使用 `docs/27_ChatGPT_Feedback_Template.md` 记录反馈

#### 2.3 保存反馈

保存到: `docs/reviews/chatgpt_round1_[文件名].md`

---

### 步骤 3: 提交给 Claude

#### 3.1 准备提交材料

**提交内容**:
1. ChatGPT 的反馈（使用模板记录）
2. 相关代码文件
3. 设计文档（如有）

#### 3.2 提交提示词

```
请分析以下 ChatGPT 的代码审查反馈，并作出回应：

## ChatGPT 审查反馈

[粘贴 ChatGPT 的反馈]

## 相关代码

[粘贴相关代码]

## 设计文档

[粘贴设计文档，如有]

请：
1. 分析每个问题的合理性
2. 解释设计决策（如果不同意）
3. 提供修复方案（如果同意）
4. 评估 ChatGPT 审查的质量
```

---

### 步骤 4: Claude 回应

#### 4.1 分析问题

- 理解 ChatGPT 的反馈
- 评估问题的合理性
- 解释设计决策

#### 4.2 提供修复方案

- 如果同意：提供修复代码
- 如果部分同意：提供改进方案
- 如果不同意：解释原因

#### 4.3 记录回应

使用 `docs/28_Claude_Response_Template.md` 记录回应

保存到: `docs/reviews/claude_response_round1_[文件名].md`

---

### 步骤 5: 修复代码

#### 5.1 根据反馈修复

- 修复高优先级问题
- 修复中优先级问题（如时间允许）

#### 5.2 验证修复

```bash
# 编译验证
go build ./...

# 代码规范检查
go vet ./...
```

---

### 步骤 6: ChatGPT 第2轮审查

#### 6.1 准备第2轮材料

**提交内容**:
1. 改进后的代码
2. Claude 的回应
3. 修复的问题列表

#### 6.2 使用第2轮提示词

```
请进行第2轮代码审查：

## 第1轮反馈

[粘贴 ChatGPT 第1轮反馈]

## Claude 的回应

[粘贴 Claude 的回应]

## 改进后的代码

[粘贴改进后的代码]

请评估：
1. 第1轮发现的问题是否已修复？
2. Claude 的回应是否合理？
3. 改进后的代码是否解决了问题？
4. 是否有新的问题？
5. 最终代码质量评分
```

#### 6.3 记录第2轮反馈

保存到: `docs/reviews/chatgpt_round2_[文件名].md`

---

### 步骤 7: 评估结果

#### 7.1 检查完成标准

- [ ] 高优先级问题已修复
- [ ] ChatGPT 确认问题已修复
- [ ] 最终评分达到 8.0/10 以上

#### 7.2 决定是否继续迭代

**如果满意**:
- ✅ 审查流程完成
- ✅ 记录最终结果

**如果不满意**:
- 🔄 返回步骤 3，继续迭代

---

## 📊 审查记录结构

```
docs/reviews/
├── chatgpt_round1_sensor_fusion.md
├── claude_response_round1_sensor_fusion.md
├── chatgpt_round2_sensor_fusion.md
├── claude_response_round2_sensor_fusion.md
└── final_review_summary.md
```

---

## 🎯 审查目标

### 第1轮目标
- 发现主要问题
- 给出初步评分
- 建立改进方向

### 第2轮目标
- 验证问题修复
- 评估改进效果
- 给出最终评分

### 最终目标
- 代码质量评分 ≥ 8.0/10
- 所有高优先级问题已修复
- ChatGPT 和 Claude 达成共识

---

## ✅ 审查完成标准

审查流程完成的标志：
- [ ] ChatGPT 第1轮审查完成
- [ ] Claude 回应所有问题
- [ ] 高优先级问题已修复
- [ ] ChatGPT 第2轮审查完成
- [ ] 最终评分达到 8.0/10 以上
- [ ] ChatGPT 和 Claude 对关键问题达成共识

---

## 📝 快速开始

### 立即执行

1. **准备审查材料**
   ```bash
   cd /Users/sady3721/project/owlBack
   # 选择关键文件，确保代码格式正确
   ```

2. **使用 ChatGPT 审查**
   - 使用 `docs/24_ChatGPT_Review_Prompt.md` 中的提示词
   - 记录反馈到 `docs/reviews/chatgpt_round1_*.md`

3. **提交给 Claude**
   - 将 ChatGPT 反馈提交给 Claude
   - Claude 分析并回应

4. **修复代码**
   - 根据反馈修复问题
   - 验证修复效果

5. **ChatGPT 第2轮审查**
   - 提交改进后的代码和 Claude 回应
   - 获得最终评价

---

## 🔗 相关文档

- [ChatGPT 审查提示词](./24_ChatGPT_Review_Prompt.md)
- [ChatGPT 反馈模板](./27_ChatGPT_Feedback_Template.md)
- [Claude 回应模板](./28_Claude_Response_Template.md)
- [代码规范](./21_Code_Standards.md)

---

**最后更新**: 2024-12-19

