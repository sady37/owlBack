# 迭代代码审查流程

> **目的**: 建立 ChatGPT 和 Claude 之间的循环审查流程，持续改进代码质量

---

## 🔄 审查流程

```
1. ChatGPT 审查代码
   ↓
2. 将 ChatGPT 反馈提交给 Claude
   ↓
3. Claude 作出回应和解释
   ↓
4. ChatGPT 进行第2次评审
   ↓
5. 重复步骤 2-4，直到满意
```

---

## 📋 流程步骤

### 阶段 1: ChatGPT 首次审查

#### 步骤 1.1: 准备审查材料

选择关键文件：
- `wisefido-sensor-fusion/internal/fusion/sensor_fusion.go`
- `wisefido-sensor-fusion/internal/repository/card.go`
- `wisefido-data-transformer/internal/transformer/sleepace.go`

#### 步骤 1.2: 使用标准提示词

参考 `docs/24_ChatGPT_Review_Prompt.md` 中的提示词模板

#### 步骤 1.3: 记录 ChatGPT 反馈

使用以下模板记录：

```markdown
# ChatGPT 审查反馈 - 第1轮

**审查日期**: _______________
**审查文件**: _______________

## 发现的问题

1. **问题描述**: _______________
   - **位置**: _______________
   - **严重性**: 高/中/低
   - **建议**: _______________

2. **问题描述**: _______________
   - **位置**: _______________
   - **严重性**: 高/中/低
   - **建议**: _______________

## 代码质量评分

**总体评分**: _______________ / 10

**分项评分**:
- 代码质量: _______________ / 10
- 性能: _______________ / 10
- 安全性: _______________ / 10
- 可维护性: _______________ / 10
```

---

### 阶段 2: Claude 回应和解释

#### 步骤 2.1: 分析 ChatGPT 反馈

Claude 需要：
1. 理解 ChatGPT 发现的问题
2. 评估问题的合理性
3. 解释设计决策（如果有）
4. 提供修复方案

#### 步骤 2.2: Claude 回应模板

```markdown
# Claude 对 ChatGPT 审查的回应

**回应日期**: _______________
**审查轮次**: 第1轮

## 问题分析

### 问题 1: [问题描述]

**Claude 分析**:
- **是否同意**: 是/否/部分同意
- **问题合理性**: 高/中/低
- **设计决策说明**: 
  - 如果不同意，解释为什么这样设计
  - 如果同意，说明如何修复

**修复方案**:
1. _______________
2. _______________

### 问题 2: [问题描述]

**Claude 分析**:
- **是否同意**: 是/否/部分同意
- **问题合理性**: 高/中/低
- **设计决策说明**: _______________

**修复方案**:
1. _______________
2. _______________

## 已修复的问题

- [ ] 问题 1: _______________
- [ ] 问题 2: _______________

## 需要进一步讨论的问题

- 问题 1: _______________
  - Claude 观点: _______________
  - 需要 ChatGPT 再次评估: 是/否

## 代码改进

**改进内容**:
1. _______________
2. _______________

**改进后的代码**:
```go
// [粘贴改进后的代码]
```
```

---

### 阶段 3: ChatGPT 第2次评审

#### 步骤 3.1: 准备第2次审查材料

包含：
1. 改进后的代码
2. Claude 的回应和解释
3. 修复的问题列表

#### 步骤 3.2: 使用第2次审查提示词

```
请进行第2次代码审查，重点关注：

## 审查内容
1. 第1轮发现的问题是否已修复？
2. Claude 的回应和解释是否合理？
3. 改进后的代码是否解决了问题？
4. 是否有新的问题？

## 第1轮反馈
[粘贴 ChatGPT 第1轮反馈]

## Claude 的回应
[粘贴 Claude 的回应]

## 改进后的代码
[粘贴改进后的代码]

请提供：
1. 问题修复评估（已修复/部分修复/未修复）
2. 对 Claude 回应的评价
3. 新发现的问题（如有）
4. 最终代码质量评分
```

---

## 📝 审查记录模板

### 审查记录 #1

**审查日期**: _______________

**审查文件**: _______________

#### ChatGPT 第1轮反馈

**发现的问题**:
1. _______________
2. _______________

**代码质量评分**: _______________ / 10

#### Claude 回应

**问题分析**:
1. 问题 1: _______________
   - 是否同意: _______________
   - 回应: _______________

**修复方案**:
1. _______________
2. _______________

#### ChatGPT 第2轮反馈

**问题修复评估**:
- 问题 1: 已修复/部分修复/未修复
- 问题 2: 已修复/部分修复/未修复

**对 Claude 回应的评价**: _______________

**新发现的问题**: _______________

**最终代码质量评分**: _______________ / 10

---

## 🎯 审查目标

### 第1轮目标
- 发现主要问题
- 给出初步评分
- 提供改进建议

### 第2轮目标
- 验证问题修复
- 评估改进效果
- 发现新问题（如有）
- 给出最终评分

---

## ✅ 审查完成标准

审查流程完成的条件：
- [ ] ChatGPT 第1轮审查完成
- [ ] Claude 回应所有问题
- [ ] 高优先级问题已修复
- [ ] ChatGPT 第2轮审查完成
- [ ] 最终评分达到 8.0/10 以上

---

## 📊 审查进度跟踪

### 当前状态

| 阶段 | 状态 | 完成时间 |
|------|------|---------|
| ChatGPT 第1轮 | ⬜ 待开始 | |
| Claude 回应 | ⬜ 待开始 | |
| 代码修复 | ⬜ 待开始 | |
| ChatGPT 第2轮 | ⬜ 待开始 | |

---

## 🔗 相关文档

- [ChatGPT 审查提示词](./24_ChatGPT_Review_Prompt.md)
- [代码规范](./21_Code_Standards.md)
- [审查前检查清单](./23_Pre_Review_Checklist.md)

---

**最后更新**: 2024-12-19

