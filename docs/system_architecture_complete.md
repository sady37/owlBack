# å®Œæ•´ç³»ç»Ÿæ¶æ„å›¾

## ğŸ—ï¸ ç³»ç»Ÿæ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           IoT è®¾å¤‡å±‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Radar è®¾å¤‡          Sleepace è®¾å¤‡ (SleepPad)                             â”‚
â”‚     â”‚                      â”‚                                              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                â”‚                                                          â”‚
â”‚                â–¼                                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚         â”‚ MQTT Broker  â”‚                                                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®é‡‡é›†å±‚ (Device Collection)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ wisefido-radar      â”‚      â”‚ wisefido-sleepace    â”‚                   â”‚
â”‚  â”‚                     â”‚      â”‚                     â”‚                   â”‚
â”‚  â”‚ - MQTT è®¢é˜…         â”‚      â”‚ - MQTT è®¢é˜…         â”‚                   â”‚
â”‚  â”‚ - æ•°æ®è§£æ          â”‚      â”‚ - æ•°æ®è§£æ          â”‚                   â”‚
â”‚  â”‚ - å‘å¸ƒåˆ° Streams    â”‚      â”‚ - å‘å¸ƒåˆ° Streams    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚             â”‚                            â”‚                               â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                          â–¼                                               â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚              â”‚   Redis Streams      â”‚                                    â”‚
â”‚              â”‚  - radar:data:stream â”‚                                    â”‚
â”‚              â”‚  - sleepace:data:... â”‚                                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®è½¬æ¢å±‚ (Data Transformation)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         wisefido-data-transformer                    â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  - æ¶ˆè´¹ radar:data:stream                            â”‚               â”‚
â”‚  â”‚  - æ¶ˆè´¹ sleepace:data:stream                         â”‚               â”‚
â”‚  â”‚  - SNOMED CT æ˜ å°„                                     â”‚               â”‚
â”‚  â”‚  - FHIR Category åˆ†ç±»                                 â”‚               â”‚
â”‚  â”‚  - æ•°æ®æ ‡å‡†åŒ–                                         â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                  â”‚                       â”‚                               â”‚
â”‚                  â–¼                       â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  PostgreSQL          â”‚   â”‚  Redis Streams       â”‚                    â”‚
â”‚  â”‚  TimescaleDB         â”‚   â”‚  iot:data:stream     â”‚                    â”‚
â”‚  â”‚  iot_timeseries      â”‚   â”‚  (æ ‡å‡†åŒ–æ•°æ®äº‹ä»¶)     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¡ç‰‡ç®¡ç†å±‚ (Card Management) âœ… å·²å®ç°                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         wisefido-card-aggregator                     â”‚               â”‚
â”‚  â”‚  (å¡ç‰‡åˆ›å»ºå’Œç»´æŠ¤æœåŠ¡) âœ… å·²å®ç°                       â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  è§¦å‘æ¡ä»¶ï¼š                                           â”‚               â”‚
â”‚  â”‚  - äº‹ä»¶é©±åŠ¨ï¼šç›‘å¬ Redis Streams (card:events)        â”‚               â”‚
â”‚  â”‚    * è®¾å¤‡ç»‘å®šå…³ç³»å˜åŒ– (devices.bound_bed_id, etc.)   â”‚               â”‚
â”‚  â”‚    * ä½æˆ·ç»‘å®šå…³ç³»å˜åŒ– (residents.bed_id, etc.)       â”‚               â”‚
â”‚  â”‚    * åºŠä½çŠ¶æ€å˜åŒ– (beds.bound_device_count)          â”‚               â”‚
â”‚  â”‚    * å•å…ƒä¿¡æ¯å˜åŒ– (units.unit_name, etc.)            â”‚               â”‚
â”‚  â”‚  - å®šæ—¶å…œåº•ï¼šæ¯å¤©ä¸Šåˆ9:00å…¨é‡æ›´æ–°                     â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  å¤„ç†é€»è¾‘ï¼š                                           â”‚               â”‚
â”‚  â”‚  - æ ¹æ®è§„åˆ™åˆ›å»º/æ›´æ–° cards è¡¨                        â”‚               â”‚
â”‚  â”‚  - è®¡ç®—å¡ç‰‡ç»‘å®šçš„è®¾å¤‡åˆ—è¡¨ (devices JSONB)            â”‚               â”‚
â”‚  â”‚  - è®¡ç®—å¡ç‰‡å…³è”çš„ä½æˆ·åˆ—è¡¨ (residents JSONB)         â”‚               â”‚
â”‚  â”‚  - æ›´æ–°å¡ç‰‡åŸºç¡€ä¿¡æ¯ (card_name, card_address)        â”‚               â”‚
â”‚  â”‚  - æ›´æ–°æŠ¥è­¦è·¯ç”±é…ç½® (routing_alarm_user_ids, tags)   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                  â”‚                                                       â”‚
â”‚                  â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         PostgreSQL - cards è¡¨                        â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  - card_id, tenant_id, card_type                     â”‚               â”‚
â”‚  â”‚  - bed_id (ActiveBed) / unit_id (Location)          â”‚               â”‚
â”‚  â”‚  - card_name, card_address                          â”‚               â”‚
â”‚  â”‚  - devices (JSONB) - é¢„è®¡ç®—çš„è®¾å¤‡åˆ—è¡¨               â”‚               â”‚
â”‚  â”‚  - residents (JSONB) - é¢„è®¡ç®—çš„ä½æˆ·åˆ—è¡¨             â”‚               â”‚
â”‚  â”‚  - routing_alarm_user_ids, routing_alarm_tags       â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                           â”‚
â”‚  âš ï¸ äº‹ä»¶å‘å¸ƒï¼šéœ€è¦åœ¨ wisefido-data API æœåŠ¡ä¸­å‘å¸ƒäº‹ä»¶åˆ° Redis Streams  â”‚
â”‚     - è®¾å¤‡ç»‘å®š/è§£ç»‘ API éœ€è¦å‘å¸ƒ device.bound/unbound äº‹ä»¶              â”‚
â”‚     - ä½æˆ·ç»‘å®š/è§£ç»‘ API éœ€è¦å‘å¸ƒ resident.bound/unbound äº‹ä»¶            â”‚
â”‚     - å•å…ƒä¿¡æ¯æ›´æ–° API éœ€è¦å‘å¸ƒ unit.info_changed äº‹ä»¶                  â”‚
â”‚                                                                           â”‚
â”‚  ğŸ“ å½“å‰çŠ¶æ€ï¼šæš‚æ—¶ä½¿ç”¨è½®è¯¢æ¨¡å¼ï¼ˆæ¯60ç§’å…¨é‡æ›´æ–°ï¼‰                         â”‚
â”‚     äº‹ä»¶å‘å¸ƒåŠŸèƒ½å¾… wisefido-data æœåŠ¡å®ç°åå†å¯ç”¨                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ âœ… å¡ç‰‡å·²åˆ›å»ºï¼Œä¼ æ„Ÿå™¨èåˆå±‚å¯ä»¥æ­£å¸¸å·¥ä½œ
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¼ æ„Ÿå™¨èåˆå±‚ (Sensor Fusion)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         wisefido-sensor-fusion                       â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  è¾“å…¥ï¼š                                               â”‚               â”‚
â”‚  â”‚  - Redis Streams: iot:data:stream (è®¾å¤‡æ•°æ®äº‹ä»¶)     â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  å¤„ç†æµç¨‹ï¼š                                           â”‚               â”‚
â”‚  â”‚  1. æ¶ˆè´¹ iot:data:stream (å•æ¡è®¾å¤‡æ•°æ®)              â”‚               â”‚
â”‚  â”‚  2. æ ¹æ® device_id æŸ¥è¯¢ cards è¡¨                     â”‚               â”‚
â”‚  â”‚     â†’ æ‰¾åˆ°è¯¥è®¾å¤‡æ‰€å±çš„å¡ç‰‡ (card_id)                 â”‚               â”‚
â”‚  â”‚  3. æŸ¥è¯¢è¯¥å¡ç‰‡çš„æ‰€æœ‰è®¾å¤‡ (cards.devices JSONB)       â”‚               â”‚
â”‚  â”‚  4. ä» iot_timeseries è·å–è¿™äº›è®¾å¤‡çš„æœ€æ–°æ•°æ®          â”‚               â”‚
â”‚  â”‚  5. èåˆæ•°æ®ï¼š                                        â”‚               â”‚
â”‚  â”‚     - HR/RR: ä¼˜å…ˆ Sleepaceï¼Œæ— åˆ™ Radar               â”‚               â”‚
â”‚  â”‚     - åºŠçŠ¶æ€/ç¡çœ çŠ¶æ€: ä¼˜å…ˆ Sleepace                  â”‚               â”‚
â”‚  â”‚     - å§¿æ€æ•°æ®: ä½¿ç”¨æ‰€æœ‰ Radar æ•°æ®                   â”‚               â”‚
â”‚  â”‚  6. è¾“å‡ºèåˆåçš„å®æ—¶æ•°æ®                              â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                  â”‚                                                       â”‚
â”‚                  â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         Redis Cache                                  â”‚               â”‚
â”‚  â”‚         vital-focus:card:{card_id}:realtime          â”‚               â”‚
â”‚  â”‚         (TTL: 5åˆ†é’Ÿ)                                 â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æŠ¥è­¦è¯„ä¼°å±‚ (Alarm Evaluation)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         wisefido-alarm                               â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  è¾“å…¥ï¼š                                               â”‚               â”‚
â”‚  â”‚  - Redis: vital-focus:card:{card_id}:realtime       â”‚               â”‚
â”‚  â”‚  - PostgreSQL: alarm_cloud, alarm_device (è§„åˆ™)     â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  å¤„ç†ï¼š                                               â”‚               â”‚
â”‚  â”‚  - è¯»å–èåˆåçš„å®æ—¶æ•°æ®                               â”‚               â”‚
â”‚  â”‚  - åº”ç”¨æŠ¥è­¦è§„åˆ™ (HR/RRå¼‚å¸¸ã€è·Œå€’ã€ç¦»åºŠç­‰)            â”‚               â”‚
â”‚  â”‚  - ç”ŸæˆæŠ¥è­¦äº‹ä»¶                                       â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                  â”‚                       â”‚                               â”‚
â”‚                  â–¼                       â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  PostgreSQL          â”‚   â”‚  Redis Cache         â”‚                    â”‚
â”‚  â”‚  alarm_events        â”‚   â”‚  vital-focus:card:   â”‚                    â”‚
â”‚  â”‚  (æŠ¥è­¦äº‹ä»¶è®°å½•)       â”‚   â”‚  {card_id}:alarms    â”‚                    â”‚
â”‚  â”‚                      â”‚   â”‚  (TTL: 30ç§’)         â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¡ç‰‡èšåˆå±‚ (Card Aggregation)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         wisefido-card-aggregator                     â”‚               â”‚
â”‚  â”‚  (å¡ç‰‡æ•°æ®èšåˆæœåŠ¡)                                   â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  è¾“å…¥ï¼š                                               â”‚               â”‚
â”‚  â”‚  - PostgreSQL: cards, devices, residents (åŸºç¡€ä¿¡æ¯)  â”‚               â”‚
â”‚  â”‚  - Redis: vital-focus:card:{card_id}:realtime       â”‚               â”‚
â”‚  â”‚  - Redis: vital-focus:card:{card_id}:alarms         â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  å¤„ç†ï¼š                                               â”‚               â”‚
â”‚  â”‚  - èšåˆæ‰€æœ‰å¡ç‰‡æ•°æ®                                   â”‚               â”‚
â”‚  â”‚  - ç»„è£…å®Œæ•´çš„ VitalFocusCard å¯¹è±¡                   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                  â”‚                                                       â”‚
â”‚                  â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         Redis Cache                                  â”‚               â”‚
â”‚  â”‚         vital-focus:card:{card_id}:full              â”‚               â”‚
â”‚  â”‚         (å®Œæ•´çš„ VitalFocusCard, TTL: 10ç§’)           â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       API æœåŠ¡å±‚ (API Service)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚         wisefido-data (HTTP API)                    â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  API åŠŸèƒ½ï¼š                                           â”‚               â”‚
â”‚  â”‚  - æ¥æ”¶ HTTP è¯·æ±‚ (JWT Token)                        â”‚               â”‚
â”‚  â”‚  - æƒé™è¿‡æ»¤ (tenant_id, role, caregiver_id)          â”‚               â”‚
â”‚  â”‚  - Focus è¿‡æ»¤ (selectedCardIds)                      â”‚               â”‚
â”‚  â”‚  - ä» Redis è¯»å– vital-focus:card:{card_id}:full     â”‚               â”‚
â”‚  â”‚  - è¿”å› VitalFocusCard[]                             â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  âš ï¸ äº‹ä»¶å‘å¸ƒåŠŸèƒ½ï¼ˆå¾…å®ç°ï¼‰ï¼š                           â”‚               â”‚
â”‚  â”‚  - è®¾å¤‡ç»‘å®š/è§£ç»‘ API â†’ å‘å¸ƒ device.bound/unbound     â”‚               â”‚
â”‚  â”‚  - ä½æˆ·ç»‘å®š/è§£ç»‘ API â†’ å‘å¸ƒ resident.bound/unbound  â”‚               â”‚
â”‚  â”‚  - å•å…ƒä¿¡æ¯æ›´æ–° API â†’ å‘å¸ƒ unit.info_changed         â”‚               â”‚
â”‚  â”‚  - å‘å¸ƒåˆ° Redis Streams: card:events                â”‚               â”‚
â”‚  â”‚                                                       â”‚               â”‚
â”‚  â”‚  ğŸ“ å¤‡æ³¨ï¼šwisefido-data æœåŠ¡å°šæœªå®ç°ï¼Œå½“å‰ä½¿ç”¨è½®è¯¢æ¨¡å¼ â”‚               â”‚
â”‚  â”‚     è¯¦è§ï¼šdocs/PENDING_FEATURES.md                  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                  â”‚                                                       â”‚
â”‚                  â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚                   å‰ç«¯ (Vue.js)                       â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ å…³é”®æ•°æ®æµ

### 1. å¡ç‰‡åˆ›å»ºæµç¨‹ï¼ˆè®¾å¤‡/ä½æˆ·/åºŠä½å˜åŒ–æ—¶ï¼‰

```
è®¾å¤‡/ä½æˆ·/åºŠä½ç»‘å®šå…³ç³»å˜åŒ–
    â”‚
    â–¼
wisefido-data (API æœåŠ¡) âš ï¸ å¾…å®ç°
    â”‚
    â”œâ”€ æ›´æ–°æ•°æ®åº“ (devices/residents/beds/units è¡¨)
    â””â”€ å‘å¸ƒäº‹ä»¶åˆ° Redis Streams (card:events)
    â”‚
    â–¼
Redis Streams: card:events
    â”‚
    â–¼
wisefido-card-aggregator (äº‹ä»¶æ¶ˆè´¹)
    â”‚
    â”œâ”€ æŸ¥è¯¢ devices, beds, residents, units è¡¨
    â”œâ”€ æ ¹æ®è§„åˆ™è®¡ç®—éœ€è¦åˆ›å»ºçš„å¡ç‰‡
    â”œâ”€ åˆ›å»º/æ›´æ–° cards è¡¨
    â”‚   â”œâ”€ card_type (ActiveBed / Location)
    â”‚   â”œâ”€ devices (JSONB) - è¯¥å¡ç‰‡ç»‘å®šçš„æ‰€æœ‰è®¾å¤‡
    â”‚   â”œâ”€ residents (JSONB) - è¯¥å¡ç‰‡å…³è”çš„æ‰€æœ‰ä½æˆ·
    â”‚   â””â”€ routing_alarm_user_ids, routing_alarm_tags
    â””â”€ å®Œæˆ

å®šæ—¶å…œåº•ï¼ˆæ¯å¤©ä¸Šåˆ9:00ï¼‰ï¼š
    â”‚
    â–¼
wisefido-card-aggregator (å®šæ—¶ä»»åŠ¡)
    â”‚
    â””â”€ å…¨é‡é‡æ–°åˆ›å»ºæ‰€æœ‰å¡ç‰‡ï¼ˆç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼‰
```

### 2. å®æ—¶æ•°æ®æµï¼ˆè®¾å¤‡æ•°æ® â†’ å¡ç‰‡æ•°æ®ï¼‰

```
IoT è®¾å¤‡å‘é€æ•°æ®
    â”‚
    â–¼
MQTT Broker
    â”‚
    â”œâ”€â†’ wisefido-radar â†’ Redis Streams (radar:data:stream)
    â””â”€â†’ wisefido-sleepace â†’ Redis Streams (sleepace:data:stream)
    â”‚
    â–¼
wisefido-data-transformer
    â”‚
    â”œâ”€ æ¶ˆè´¹ radar:data:stream
    â”œâ”€ æ¶ˆè´¹ sleepace:data:stream
    â”œâ”€ æ•°æ®æ ‡å‡†åŒ– (SNOMED CT, FHIR Category)
    â”œâ”€â†’ PostgreSQL (iot_timeseries) - æŒä¹…åŒ–å­˜å‚¨
    â””â”€â†’ Redis Streams (iot:data:stream) - è§¦å‘ä¸‹æ¸¸
    â”‚
    â–¼
wisefido-sensor-fusion
    â”‚
    â”œâ”€ æ¶ˆè´¹ iot:data:stream (å•æ¡è®¾å¤‡æ•°æ®äº‹ä»¶)
    â”œâ”€ æ ¹æ® device_id æŸ¥è¯¢ cards è¡¨
    â”‚   â””â”€ æ‰¾åˆ°è¯¥è®¾å¤‡æ‰€å±çš„å¡ç‰‡ (card_id)
    â”œâ”€ æŸ¥è¯¢è¯¥å¡ç‰‡çš„æ‰€æœ‰è®¾å¤‡ (cards.devices JSONB)
    â”œâ”€ ä» iot_timeseries è·å–è¿™äº›è®¾å¤‡çš„æœ€æ–°æ•°æ®
    â”œâ”€ èåˆæ•°æ® (HR/RR, åºŠçŠ¶æ€, å§¿æ€)
    â””â”€â†’ Redis (vital-focus:card:{card_id}:realtime)
    â”‚
    â–¼
wisefido-alarm
    â”‚
    â”œâ”€ è¯»å– vital-focus:card:{card_id}:realtime
    â”œâ”€ è¯»å–æŠ¥è­¦è§„åˆ™ (alarm_cloud, alarm_device)
    â”œâ”€ è¯„ä¼°æŠ¥è­¦æ¡ä»¶
    â”œâ”€â†’ PostgreSQL (alarm_events)
    â””â”€â†’ Redis (vital-focus:card:{card_id}:alarms)
    â”‚
    â–¼
wisefido-card-aggregator (èšåˆ)
    â”‚
    â”œâ”€ è¯»å– cards, devices, residents (åŸºç¡€ä¿¡æ¯)
    â”œâ”€ è¯»å– vital-focus:card:{card_id}:realtime
    â”œâ”€ è¯»å– vital-focus:card:{card_id}:alarms
    â”œâ”€ èšåˆæ‰€æœ‰æ•°æ®
    â””â”€â†’ Redis (vital-focus:card:{card_id}:full)
    â”‚
    â–¼
wisefido-data (API)
    â”‚
    â”œâ”€ æ¥æ”¶ HTTP è¯·æ±‚
    â”œâ”€ æƒé™è¿‡æ»¤
    â”œâ”€ è¯»å– vital-focus:card:{card_id}:full
    â””â”€â†’ HTTP å“åº” (VitalFocusCard[])
```

## ğŸ¯ å…³é”®è®¾è®¡ç‚¹

### 1. å¡ç‰‡æ˜¯é¢„å…ˆå­˜åœ¨çš„
- **å¡ç‰‡åˆ›å»º**ï¼šç”± `wisefido-card-aggregator` æœåŠ¡è´Ÿè´£ï¼Œå½“è®¾å¤‡/ä½æˆ·/åºŠä½ç»‘å®šå…³ç³»å˜åŒ–æ—¶è§¦å‘
- **å¡ç‰‡å­˜å‚¨**ï¼šPostgreSQL `cards` è¡¨ï¼ŒåŒ…å«é¢„è®¡ç®—çš„ `devices` å’Œ `residents` JSONB å­—æ®µ
- **å¡ç‰‡ç±»å‹**ï¼š`ActiveBed`ï¼ˆåºŠä½å¡ç‰‡ï¼‰æˆ– `Location`ï¼ˆé—¨ç‰Œå·å¡ç‰‡ï¼‰

### 2. æ•°æ®æµæ˜¯å¡ç‰‡é©±åŠ¨çš„
- **è§¦å‘**ï¼šè®¾å¤‡æ•°æ®åˆ°è¾¾ `iot:data:stream`
- **æŸ¥è¯¢**ï¼šæ ¹æ® `device_id` æŸ¥è¯¢è¯¥è®¾å¤‡æ‰€å±çš„å¡ç‰‡
- **èåˆ**ï¼šèåˆè¯¥å¡ç‰‡ä¸Š**æ‰€æœ‰è®¾å¤‡**çš„æ•°æ®ï¼ˆä¸æ˜¯å•ä¸ªè®¾å¤‡ï¼‰
- **è¾“å‡º**ï¼šä»¥å¡ç‰‡ä¸ºå•ä½è¾“å‡ºèåˆåçš„å®æ—¶æ•°æ®

### 3. æœåŠ¡èŒè´£åˆ†ç¦»
- **wisefido-card-aggregator**ï¼šå¡ç‰‡åˆ›å»ºå’Œç»´æŠ¤ï¼ˆåŸºç¡€ä¿¡æ¯ï¼‰
- **wisefido-sensor-fusion**ï¼šä¼ æ„Ÿå™¨æ•°æ®èåˆï¼ˆå®æ—¶æ•°æ®ï¼‰
- **wisefido-alarm**ï¼šæŠ¥è­¦è§„åˆ™è¯„ä¼°ï¼ˆæŠ¥è­¦æ•°æ®ï¼‰
- **wisefido-card-aggregator**ï¼šå¡ç‰‡æ•°æ®èšåˆï¼ˆå®Œæ•´å¡ç‰‡å¯¹è±¡ï¼‰
- **wisefido-data**ï¼šAPI æœåŠ¡ï¼ˆHTTP æ¥å£ï¼‰

## âš ï¸ å½“å‰é—®é¢˜åˆ†æ

### âš ï¸ å…³é”®é—®é¢˜ï¼šå®ç°é¡ºåºé”™è¯¯

**é—®é¢˜**ï¼š
1. **wisefido-sensor-fusion** å·²ç»å®ç° âœ…
2. **wisefido-card-aggregator** çš„å¡ç‰‡åˆ›å»ºåŠŸèƒ½**æœªå®ç°** âŒ
3. **wisefido-sensor-fusion** ä¾èµ– `cards` è¡¨ï¼Œä½†å¡ç‰‡è¿˜æœªåˆ›å»º

**å½±å“**ï¼š
- å¦‚æœ `cards` è¡¨ä¸ºç©ºï¼Œ`wisefido-sensor-fusion` æ— æ³•å·¥ä½œ
- `GetCardByDeviceID` ä¼šè¿”å›é”™è¯¯ï¼Œå¯¼è‡´èåˆå¤±è´¥

**æ­£ç¡®çš„å®ç°é¡ºåºåº”è¯¥æ˜¯**ï¼š
1. âœ… æ•°æ®é‡‡é›†å±‚ï¼ˆwisefido-radar, wisefido-sleepaceï¼‰
2. âœ… æ•°æ®è½¬æ¢å±‚ï¼ˆwisefido-data-transformerï¼‰
3. âš ï¸ **å¡ç‰‡ç®¡ç†å±‚ï¼ˆwisefido-card-aggregator - å¡ç‰‡åˆ›å»ºï¼‰** â† **åº”è¯¥å…ˆå®ç°è¿™ä¸ª**
4. âœ… ä¼ æ„Ÿå™¨èåˆå±‚ï¼ˆwisefido-sensor-fusionï¼‰â† **ä¾èµ–å¡ç‰‡ï¼Œåº”è¯¥åå®ç°**
5. â³ æŠ¥è­¦è¯„ä¼°å±‚ï¼ˆwisefido-alarmï¼‰
6. â³ å¡ç‰‡èšåˆå±‚ï¼ˆwisefido-card-aggregator - æ•°æ®èšåˆï¼‰
7. â³ API æœåŠ¡å±‚ï¼ˆwisefido-dataï¼‰

### é—®é¢˜ï¼šwisefido-sensor-fusion çš„æµç¨‹

**å½“å‰æµç¨‹**ï¼š
1. æ¶ˆè´¹ `iot:data:stream`ï¼ˆå•æ¡è®¾å¤‡æ•°æ®ï¼‰
2. æ ¹æ® `device_id` æŸ¥è¯¢å¡ç‰‡ â† **å¦‚æœ cards è¡¨ä¸ºç©ºï¼Œè¿™é‡Œä¼šå¤±è´¥**
3. èåˆè¯¥å¡ç‰‡çš„æ‰€æœ‰è®¾å¤‡æ•°æ®
4. æ›´æ–° Redis ç¼“å­˜

**æ½œåœ¨é—®é¢˜**ï¼š
- âœ… æµç¨‹åŸºæœ¬æ­£ç¡®ï¼šè®¾å¤‡æ•°æ® â†’ æ‰¾åˆ°å¡ç‰‡ â†’ èåˆå¡ç‰‡æ•°æ®
- âš ï¸ **ä½†å‰ææ˜¯ cards è¡¨å¿…é¡»æœ‰æ•°æ®**ï¼ˆéœ€è¦å…ˆå®ç°å¡ç‰‡åˆ›å»ºåŠŸèƒ½ï¼‰

## ğŸ“ æ€»ç»“

ç³»ç»Ÿæ¶æ„æ˜¯**å¡ç‰‡ä¸­å¿ƒ**çš„ï¼š
1. **å¡ç‰‡é¢„å…ˆå­˜åœ¨**ï¼ˆç”± card-aggregator åˆ›å»ºå’Œç»´æŠ¤ï¼‰âœ… **å·²å®ç°**
2. **æ•°æ®æµä»¥å¡ç‰‡ä¸ºå•ä½**ï¼ˆè®¾å¤‡æ•°æ®è§¦å‘ï¼Œä½†å¤„ç†å¡ç‰‡æ•°æ®ï¼‰
3. **æœåŠ¡èŒè´£æ¸…æ™°**ï¼ˆé‡‡é›† â†’ è½¬æ¢ â†’ **å¡ç‰‡åˆ›å»º** â†’ **ä¼ æ„Ÿå™¨èåˆ** â†’ æŠ¥è­¦ â†’ èšåˆ â†’ APIï¼‰

### âœ… å½“å‰å®ç°çŠ¶æ€

**å·²å®ç°** âœ…ï¼š
- æ•°æ®é‡‡é›†å±‚ï¼ˆwisefido-radar, wisefido-sleepaceï¼‰
- æ•°æ®è½¬æ¢å±‚ï¼ˆwisefido-data-transformerï¼‰
- **å¡ç‰‡ç®¡ç†å±‚ï¼ˆwisefido-card-aggregator - å¡ç‰‡åˆ›å»ºï¼‰** âœ… **å·²å®Œæˆ**
- **ä¼ æ„Ÿå™¨èåˆå±‚ï¼ˆwisefido-sensor-fusionï¼‰** âœ… **å·²å®ç°ï¼Œä¾èµ–å¡ç‰‡**

**æœªå®ç°** âŒï¼š
- **ä¼ æ„Ÿå™¨èåˆéªŒè¯** â³ **éœ€è¦éªŒè¯**ï¼šç¡®ä¿ wisefido-sensor-fusion èƒ½æ­£ç¡®è¯»å–å¡ç‰‡å¹¶èåˆæ•°æ®
- **wisefido-data API æœåŠ¡çš„äº‹ä»¶å‘å¸ƒåŠŸèƒ½** â¸ï¸ **å·²æš‚åœï¼Œä½¿ç”¨è½®è¯¢æ¨¡å¼**
  - è®¾å¤‡ç»‘å®š/è§£ç»‘ API éœ€è¦å‘å¸ƒäº‹ä»¶
  - ä½æˆ·ç»‘å®š/è§£ç»‘ API éœ€è¦å‘å¸ƒäº‹ä»¶
  - å•å…ƒä¿¡æ¯æ›´æ–° API éœ€è¦å‘å¸ƒäº‹ä»¶
- æŠ¥è­¦è¯„ä¼°å±‚ï¼ˆwisefido-alarmï¼‰
- å¡ç‰‡èšåˆå±‚ï¼ˆwisefido-card-aggregator - æ•°æ®èšåˆï¼‰
- API æœåŠ¡å±‚ï¼ˆwisefido-data - HTTP API åŠŸèƒ½ï¼‰

### ğŸ”§ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ä¼˜å…ˆçº§ 1**ï¼šéªŒè¯ä¼ æ„Ÿå™¨èåˆåŠŸèƒ½ âœ… **å¡ç‰‡å·²åˆ›å»ºï¼Œåº”è¯¥éªŒè¯èåˆ**
- ç¡®ä¿ `wisefido-sensor-fusion` å¯ä»¥æ­£ç¡®æŸ¥è¯¢åˆ°å¡ç‰‡æ•°æ®
- éªŒè¯èåˆé€»è¾‘æ˜¯å¦æ­£ç¡®ï¼ˆHR/RRã€åºŠçŠ¶æ€ã€å§¿æ€æ•°æ®ï¼‰
- éªŒè¯ Redis ç¼“å­˜æ›´æ–°æ˜¯å¦æ­£å¸¸ï¼ˆ`vital-focus:card:{card_id}:realtime`ï¼‰
- æµ‹è¯•å®Œæ•´æ•°æ®æµï¼šè®¾å¤‡æ•°æ® â†’ ä¼ æ„Ÿå™¨èåˆ â†’ ç¼“å­˜æ›´æ–°

**ä¼˜å…ˆçº§ 2**ï¼šå®ç°æŠ¥è­¦è¯„ä¼°å±‚ï¼ˆwisefido-alarmï¼‰
- è¯»å–èåˆåçš„å®æ—¶æ•°æ®ï¼ˆ`vital-focus:card:{card_id}:realtime`ï¼‰
- å®ç°æŠ¥è­¦è§„åˆ™è¯„ä¼°ï¼ˆHR/RRå¼‚å¸¸ã€è·Œå€’ã€ç¦»åºŠç­‰ï¼‰
- å†™å…¥æŠ¥è­¦äº‹ä»¶åˆ° PostgreSQLï¼ˆ`alarm_events` è¡¨ï¼‰
- æ›´æ–°æŠ¥è­¦ç¼“å­˜åˆ° Redisï¼ˆ`vital-focus:card:{card_id}:alarms`ï¼‰

**ä¼˜å…ˆçº§ 3**ï¼šå®ç° `wisefido-data` API æœåŠ¡çš„äº‹ä»¶å‘å¸ƒåŠŸèƒ½ â¸ï¸ **å·²æš‚åœï¼Œä½¿ç”¨è½®è¯¢æ¨¡å¼**
- åœ¨è®¾å¤‡ç»‘å®š/è§£ç»‘ API ä¸­å‘å¸ƒ `device.bound/unbound` äº‹ä»¶
- åœ¨ä½æˆ·ç»‘å®š/è§£ç»‘ API ä¸­å‘å¸ƒ `resident.bound/unbound` äº‹ä»¶
- åœ¨å•å…ƒä¿¡æ¯æ›´æ–° API ä¸­å‘å¸ƒ `unit.info_changed` äº‹ä»¶
- å‘å¸ƒåˆ° Redis Streams: `card:events`
- **å½“å‰çŠ¶æ€**ï¼š`wisefido-data` æœåŠ¡å°šæœªå®ç°ï¼Œæš‚æ—¶ä½¿ç”¨è½®è¯¢æ¨¡å¼ï¼ˆæ¯60ç§’å…¨é‡æ›´æ–°ï¼‰
- **å¾…å®ç°æ–‡æ¡£**ï¼š`docs/PENDING_FEATURES.md`

