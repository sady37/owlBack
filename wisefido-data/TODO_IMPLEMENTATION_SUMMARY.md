# TODO å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„ TODOï¼ˆ6ä¸ªï¼‰

### 1. âœ… `resident_handler.go:905` - PHI å­—æ®µæå–
**å®ç°å†…å®¹**ï¼š
- ä» `payload["phi"]` ä¸­æå–æ‰€æœ‰ PHI å­—æ®µ
- è½¬æ¢ä¸º `UpdateResidentPHIRequest` ç»“æ„
- æ”¯æŒæ‰€æœ‰ PHI å­—æ®µçš„æ›´æ–°ï¼ˆåŒ…æ‹¬ first_name, last_name, gender, date_of_birth, resident_phone, resident_email, weight_lb, height_ft, height_in, mobility_level, tremor_status, mobility_aid, adl_assistance, comm_status, has_hypertension, has_hyperlipaemia, has_hyperglycaemia, has_stroke_history, has_paralysis, has_alzheimer, medical_history, HIS_resident_name, HIS_resident_admission_date, HIS_resident_discharge_date, home_address_street, home_address_city, home_address_state, home_address_postal_code, plus_codeï¼‰

**æ–‡ä»¶**ï¼š`internal/http/resident_handler.go`

---

### 2. âœ… `auth_service.go:436` - å‘é€éªŒè¯ç 
**å®ç°å†…å®¹**ï¼š
- ç”Ÿæˆ6ä½æ•°å­—éªŒè¯ç ï¼ˆ100000-999999ï¼‰
- éªŒè¯è´¦å·æ˜¯å¦å­˜åœ¨ï¼ˆæ”¯æŒ staff å’Œ residentï¼‰
- å­˜å‚¨éªŒè¯ç åˆ°å†…å­˜ï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
- æ”¯æŒåå°æ¸…ç†è¿‡æœŸéªŒè¯ç 
- å®‰å…¨è®¾è®¡ï¼šå³ä½¿è´¦å·ä¸å­˜åœ¨ä¹Ÿè¿”å›æˆåŠŸï¼ˆé˜²æ­¢è´¦å·æšä¸¾æ”»å‡»ï¼‰

**æ–‡ä»¶**ï¼š`internal/service/auth_service.go`
**æ³¨æ„**ï¼šå®é™…å‘é€é‚®ä»¶/çŸ­ä¿¡åŠŸèƒ½æ ‡è®°ä¸º TODOï¼Œéœ€è¦é›†æˆé‚®ä»¶æœåŠ¡æˆ–çŸ­ä¿¡æœåŠ¡

---

### 3. âœ… `auth_service.go:458` - éªŒè¯éªŒè¯ç 
**å®ç°å†…å®¹**ï¼š
- éªŒè¯éªŒè¯ç æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥éªŒè¯ç æ˜¯å¦è¿‡æœŸ
- éªŒè¯æˆåŠŸåç”Ÿæˆé‡ç½®ä»¤ç‰Œï¼ˆ32å­—èŠ‚éšæœºä»¤ç‰Œï¼‰
- å­˜å‚¨é‡ç½®ä»¤ç‰Œåˆ°å†…å­˜ï¼ˆ10åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
- åˆ é™¤å·²ä½¿ç”¨çš„éªŒè¯ç 

**æ–‡ä»¶**ï¼š`internal/service/auth_service.go`

---

### 4. âœ… `auth_service.go:477` - é‡ç½®å¯†ç 
**å®ç°å†…å®¹**ï¼š
- éªŒè¯é‡ç½®ä»¤ç‰Œ
- æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦è¿‡æœŸ
- éªŒè¯ user_type æ˜¯å¦åŒ¹é…
- æ›´æ–°å¯†ç ï¼ˆæ”¯æŒ staff å’Œ residentï¼ŒåŒ…æ‹¬ resident_contactsï¼‰
- ä½¿ç”¨ SHA256 å¯¹å¯†ç è¿›è¡Œ hash
- åˆ é™¤å·²ä½¿ç”¨çš„é‡ç½®ä»¤ç‰Œ

**æ–‡ä»¶**ï¼š`internal/service/auth_service.go`

---

### 5. âœ… `alarm_cloud_service.go:76` - æƒé™æ£€æŸ¥ï¼ˆGetAlarmCloudConfigï¼‰
**å®ç°å†…å®¹**ï¼š
- æ·»åŠ æƒé™æ£€æŸ¥é€»è¾‘
- SystemAdmin å’Œ Admin å¯ä»¥ç›´æ¥è®¿é—®
- å…¶ä»–è§’è‰²éœ€è¦æ£€æŸ¥ `role_permissions` è¡¨ä¸­çš„æƒé™é…ç½®
- å¦‚æœæ²¡æœ‰æƒé™è®°å½•ï¼Œè¿”å›æœ€ä¸¥æ ¼çš„æƒé™ï¼ˆä¸å…è®¸è®¿é—®ï¼‰

**æ–‡ä»¶**ï¼š`internal/service/alarm_cloud_service.go`
**æ³¨æ„**ï¼šä¸ºäº†é¿å…å¾ªç¯å¯¼å…¥ï¼Œåœ¨ service å±‚å®ç°äº† `getResourcePermission` å‡½æ•°ï¼ˆå¤åˆ¶äº† `httpapi.GetResourcePermission` çš„é€»è¾‘ï¼‰

---

### 6. âœ… `alarm_cloud_service.go:155` - æƒé™æ£€æŸ¥ï¼ˆUpdateAlarmCloudConfigï¼‰
**å®ç°å†…å®¹**ï¼š
- æ·»åŠ æƒé™æ£€æŸ¥é€»è¾‘ï¼ˆå¿…å¡«ï¼‰
- SystemAdmin å’Œ Admin å¯ä»¥ç›´æ¥æ›´æ–°
- å…¶ä»–è§’è‰²éœ€è¦æ£€æŸ¥ `role_permissions` è¡¨ä¸­çš„æƒé™é…ç½®
- å¦‚æœæ²¡æœ‰æƒé™è®°å½•ï¼Œè¿”å›æœ€ä¸¥æ ¼çš„æƒé™ï¼ˆä¸å…è®¸æ›´æ–°ï¼‰

**æ–‡ä»¶**ï¼š`internal/service/alarm_cloud_service.go`

---

## ğŸ“‹ æŠ€æœ¯å®ç°ç»†èŠ‚

### éªŒè¯ç å’Œé‡ç½®å¯†ç åŠŸèƒ½
- **å­˜å‚¨æ–¹å¼**ï¼šå†…å­˜å­˜å‚¨ï¼ˆä½¿ç”¨ `sync.RWMutex` ä¿æŠ¤å¹¶å‘è®¿é—®ï¼‰
- **éªŒè¯ç æœ‰æ•ˆæœŸ**ï¼š5åˆ†é’Ÿ
- **é‡ç½®ä»¤ç‰Œæœ‰æ•ˆæœŸ**ï¼š10åˆ†é’Ÿ
- **å¯†ç  hash**ï¼šSHA256ï¼ˆç‹¬ç«‹äºè´¦å·ï¼Œä»… hash å¯†ç æœ¬èº«ï¼‰
- **å®‰å…¨è®¾è®¡**ï¼š
  - é˜²æ­¢è´¦å·æšä¸¾æ”»å‡»ï¼ˆå³ä½¿è´¦å·ä¸å­˜åœ¨ä¹Ÿè¿”å›æˆåŠŸï¼‰
  - éªŒè¯ç å’Œä»¤ç‰Œè‡ªåŠ¨è¿‡æœŸ
  - åå°æ¸…ç†è¿‡æœŸæ•°æ®

### æƒé™æ£€æŸ¥åŠŸèƒ½
- **å®ç°æ–¹å¼**ï¼šåœ¨ service å±‚å®ç° `getResourcePermission` å‡½æ•°ï¼ˆé¿å…å¾ªç¯å¯¼å…¥ï¼‰
- **æƒé™è¡¨**ï¼š`role_permissions` è¡¨
- **é»˜è®¤æƒé™**ï¼šå¦‚æœæ²¡æœ‰æƒé™è®°å½•ï¼Œè¿”å›æœ€ä¸¥æ ¼çš„æƒé™ï¼ˆassigned_only=true, branch_only=trueï¼‰
- **ç‰¹æ®Šè§’è‰²**ï¼šSystemAdmin å’Œ Admin å¯ä»¥ç›´æ¥è®¿é—®/æ›´æ–°

### PHI å­—æ®µæå–
- **æ”¯æŒå­—æ®µ**ï¼šæ‰€æœ‰ PHI å­—æ®µï¼ˆ33ä¸ªå­—æ®µï¼‰
- **ç±»å‹è½¬æ¢**ï¼š
  - æ—¥æœŸå­—æ®µï¼šä»å­—ç¬¦ä¸²è½¬æ¢ä¸º Unix æ—¶é—´æˆ³
  - æ•°å€¼å­—æ®µï¼šä» float64 è½¬æ¢ä¸ºå¯¹åº”ç±»å‹
  - å¸ƒå°”å­—æ®µï¼šç›´æ¥ä½¿ç”¨ bool å€¼

---

## ğŸ”„ ä»£ç å˜æ›´

### æ–°å¢ä¾èµ–
- `auth_service.go`ï¼šæ·»åŠ  `*sql.DB` å­—æ®µç”¨äºéªŒè¯ç å’Œé‡ç½®å¯†ç åŠŸèƒ½
- `alarm_cloud_service.go`ï¼šæ·»åŠ  `*sql.DB` å­—æ®µç”¨äºæƒé™æ£€æŸ¥

### å‡½æ•°ç­¾åå˜æ›´
- `NewAuthService`ï¼šæ–°å¢ `db *sql.DB` å‚æ•°
- `NewAlarmCloudService`ï¼šæ–°å¢ `db *sql.DB` å‚æ•°

### æµ‹è¯•æ–‡ä»¶æ›´æ–°
- `auth_service_integration_test.go`ï¼šæ›´æ–°æ‰€æœ‰ `NewAuthService` è°ƒç”¨
- `alarm_cloud_service_integration_test.go`ï¼šæ›´æ–°æ‰€æœ‰ `NewAlarmCloudService` è°ƒç”¨
- `auth_handler_test.go`ï¼šæ›´æ–°æ‰€æœ‰ `NewAuthService` è°ƒç”¨

---

## âš ï¸ å¾…å®Œå–„åŠŸèƒ½

### 1. éªŒè¯ç å‘é€åŠŸèƒ½
**å½“å‰çŠ¶æ€**ï¼šåªç”ŸæˆéªŒè¯ç å¹¶è®°å½•æ—¥å¿—ï¼Œä¸å®é™…å‘é€
**TODO**ï¼šé›†æˆé‚®ä»¶æœåŠ¡æˆ–çŸ­ä¿¡æœåŠ¡ï¼Œå®é™…å‘é€éªŒè¯ç åˆ°ç”¨æˆ·é‚®ç®±æˆ–æ‰‹æœº

### 2. éªŒè¯ç å­˜å‚¨ä¼˜åŒ–
**å½“å‰çŠ¶æ€**ï¼šä½¿ç”¨å†…å­˜å­˜å‚¨ï¼ˆé‡å¯åä¸¢å¤±ï¼‰
**å»ºè®®**ï¼šåç»­å¯ä»¥æ”¹ä¸º Redis å­˜å‚¨ï¼Œæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²å’ŒæŒä¹…åŒ–

### 3. é‡ç½®ä»¤ç‰Œå­˜å‚¨ä¼˜åŒ–
**å½“å‰çŠ¶æ€**ï¼šä½¿ç”¨å†…å­˜å­˜å‚¨ï¼ˆé‡å¯åä¸¢å¤±ï¼‰
**å»ºè®®**ï¼šåç»­å¯ä»¥æ”¹ä¸º Redis å­˜å‚¨ï¼Œæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²å’ŒæŒä¹…åŒ–

---

## âœ… ç¼–è¯‘çŠ¶æ€

æ‰€æœ‰ä»£ç å·²ç¼–è¯‘é€šè¿‡ï¼Œæ— é”™è¯¯ã€‚

